\subsubsection{Magic/Latin square of Knut Vik design (Z3Py)}

``Knut Vik design'' is a square, where all (broken) diagonals has distinct numbers.

This is diagonal of 5*5 square:

\begin{lstlisting}
. . . . *
. . . * .
. . * . .
. * . . .
* . . . .
\end{lstlisting}

These are broken diagonals:

\begin{lstlisting}
. . * . .
. . . * .
. . . . *
* . . . .
. * . . .
\end{lstlisting}

\begin{lstlisting}
* . . . .
. . . . *
. . . * .
. . * . .
. * . . .
\end{lstlisting}

I could only find 5*5 and 7*7 squares using Z3, couldn't find 11*11 square, however, it's possible to prove there are no 6*6 and 4*4 squares (such squares doesn't exist if size is divisible by 2 or 3).

\lstinputlisting[style=custompy]{latin/knut_vik/knut_vik1.py}

5*5 Knut Vik square:

\begin{lstlisting}
3 4 5 1 2
5 1 2 3 4
2 3 4 5 1
4 5 1 2 3
1 2 3 4 5
\end{lstlisting}

7*7:

\begin{lstlisting}
4 7 6 5 1 2 3
6 5 1 2 3 4 7
1 2 3 4 7 6 5
3 4 7 6 5 1 2
7 6 5 1 2 3 4
5 1 2 3 4 7 6
2 3 4 7 6 5 1
\end{lstlisting}

This is a good example of NP-problem: you can check the result visually, but it takes several seconds for computer to find it.

% TODO one-hot
We can also use different encoding: each number can be represented by one bit. 0b0001 for 1, 0b0010 for 2, 0b1000 for 4, etc.
Then a "Distinct" operator can be replaced by OR operation and comparison against mask with all bits present.

\lstinputlisting[style=custompy]{latin/knut_vik/knut_vik2.py}

That works twice as faster (however, numbers are in 0..SIZE-1 range instead of 1..SIZE, but you've got the idea).

Besides recreational mathematics, Knut Vik squares like these are very important in design of experiments.

Further reading:\\
\\
\begin{itemize}
\item A. Hedayat and W, T. Federer - On the Nonexistence of Knut Vik Designs for all Even Orders (1973)

\item A. Hedayat - A Complete Solution to the Existence and Nonexistence of Knut Vik Designs and Orthogonal Knut Vik Designs (1975)
\end{itemize}

